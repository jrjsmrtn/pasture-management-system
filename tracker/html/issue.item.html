<!-- dollarId: issue.item,v 1.4 2001/08/03 01:19:43 richard Exp dollar-->
<tal:block metal:use-macro="templates/page/macros/icing">
<title metal:fill-slot="head_title">
<tal:block condition="context/id" i18n:translate=""
 >Issue <tal:x tal:content="context/id" i18n:name="id"
 />: <tal:x content="context/title" i18n:name="title"
 /> - <tal:x content="config/TRACKER_NAME" i18n:name="tracker"
/></tal:block>
<tal:block condition="not:context/id" i18n:translate=""
 >New Issue - <span tal:replace="config/TRACKER_NAME" i18n:name="tracker"
/></tal:block>
</title>
<tal:block metal:fill-slot="body_title">
 <span tal:condition="python: not (context.id or context.is_edit_ok())"
  tal:omit-tag="python:1" i18n:translate="">New Issue</span>
 <span tal:condition="python: not context.id and context.is_edit_ok()"
  tal:omit-tag="python:1" i18n:translate="">New Issue Editing</span>
 <span tal:condition="python: context.id and not context.is_edit_ok()"
  tal:omit-tag="python:1" i18n:translate="">Issue<tal:x
  replace="context/id" i18n:name="id" /></span>
 <span tal:condition="python: context.id and context.is_edit_ok()"
  tal:omit-tag="python:1" i18n:translate="">Issue<tal:x
  replace="context/id" i18n:name="id" /> Editing</span>
</tal:block>

<td class="content" metal:fill-slot="content">

<p tal:condition="python:not (context.is_view_ok()
 or request.user.hasRole('Anonymous'))" i18n:translate="">
 You are not allowed to view this page.</p>

<p tal:condition="python:not context.is_view_ok()
 and request.user.hasRole('Anonymous')" i18n:translate="">
 Please login with your username and password.</p>

<div tal:condition="context/is_view_ok">

<form method="POST" name="itemSynopsis"
      onSubmit="return submit_once()" enctype="multipart/form-data"
      tal:attributes="action context/designator">

<table class="form">
<tr>
 <th class="required" i18n:translate="">Title</th>
 <td colspan=3 tal:content="structure python:context.title.field(size=60)">title</td>
</tr>

<tr>
 <th class="required" i18n:translate="">Priority</th>
 <td tal:content="structure context/priority/menu">priority</td>
 <th i18n:translate="">Status</th>
 <td tal:content="structure context/status/menu">status</td>
</tr>

<tr>
 <th i18n:translate="">Superseder</th>
 <td>
  <span tal:replace="structure python:context.superseder.field(showid=1, size=20)" />
  <roundup-classhelper data-search-with="title,status[],keyword[],id">
    <span tal:condition="context/is_edit_ok"
	  tal:replace="structure python:db.issue.classhelp('id,title',
		       property='superseder')" />
  </roundup-classhelper>
  <span tal:condition="context/superseder">
   <br><span i18n:translate="">View:</span>
     <a tal:repeat="sup context/superseder"
        tal:content="python:sup['id'] + ', '*(not repeat['sup'].end)"
        tal:attributes="href string:issue${sup/id}"></a>
  </span>
 </td>
 <th i18n:translate="">Nosy List</th>
 <td>
  <span tal:replace="structure context/nosy/field" />
  <roundup-classhelper
    tal:define="search string:username,realname,phone,roles[]"
    tal:attributes="data-search-with python:search
		    if request.user.hasRole('Admin') else
		    ','.join(search.split(',')[:-1])">
    <span tal:condition="context/is_edit_ok"
	  tal:replace="structure
		       python:db.user.classhelp(
		       'username,realname,address',
		       property='nosy',
		       width='600')" /></roundup-classhelper><br>
 </td>
</tr>

<tr>
 <th i18n:translate="">Assigned To</th>
 <td tal:content="structure context/assignedto/menu">assignedto menu</td>
 <th i18n:translate="">Keywords</th>
 <td>
  <span tal:replace="structure context/keyword/field" />
  <roundup-classhelper data-search-with="name">
    <span tal:condition="context/is_edit_ok"
	  tal:replace="structure
		       python:db.keyword.classhelp(property='keyword')" />
  </roundup-classhelper>
 </td>
</tr>

<tr>
 <th i18n:translate="">Affected CIs</th>
 <td colspan=3>
  <span tal:replace="structure context/affected_cis/field" />
  <roundup-classhelper data-search-with="name,type[],status[]">
    <span tal:condition="context/is_edit_ok"
	  tal:replace="structure python:db.ci.classhelp('id,name,type,status',
		       property='affected_cis', width='600')" />
  </roundup-classhelper>
  <tal:block tal:condition="context/affected_cis">
   <br><span i18n:translate="">View:</span>
   <ul style="margin: 0; padding-left: 20px;">
    <li tal:repeat="ci context/affected_cis">
     <a tal:attributes="href string:ci${ci/id}"
        tal:content="python:f'{ci.name} ({db.citype.get(ci.type, \"name\")})'">CI link</a>
     <tal:block tal:condition="python:hasattr(ci, 'criticality') and ci.criticality">
      - Criticality: <strong tal:content="python:db.cicriticality.get(ci.criticality, 'name')">criticality</strong>
     </tal:block>
    </li>
   </ul>
  </tal:block>
 </td>
</tr>

<tr tal:condition="context/id">
 <th i18n:translate="">Related Changes</th>
 <td colspan=3>
  <tal:block tal:define="related_changes python:db.change.filter(None, {'related_issues': context.id})">
   <tal:block tal:condition="related_changes">
    <ul style="margin: 0; padding-left: 20px;">
     <li tal:repeat="change_id related_changes">
      <tal:block tal:define="change python:db.change.getnode(change_id)">
       <a tal:attributes="href string:change${change_id}"
          tal:content="python:f'change{change_id}: {change.title}'">change link</a>
       (<span tal:replace="python:db.changestatus.get(change.status, 'name')">status</span>)
      </tal:block>
     </li>
    </ul>
   </tal:block>
   <tal:block tal:condition="not:related_changes">
    <em i18n:translate="">No related changes</em>
   </tal:block>
  </tal:block>
 </td>
</tr>

<tr tal:condition="context/is_edit_ok">
 <th i18n:translate="">Change Note</th>
 <td colspan=3>
  <textarea tal:content="request/form/@note/value | default"
            name="@note" wrap="hard" rows="5" cols="80"></textarea>
 </td>
</tr>

<tr tal:condition="context/is_edit_ok">
 <th i18n:translate="">File</th>
 <td colspan=3><input type="file" name="@file" size="40"></td>
</tr>

<tr tal:condition="context/is_edit_ok">
 <td>
  &nbsp;
  <input type="hidden" name="@template" value="item">
  <input type="hidden" name="@required" value="title,priority">
 </td>
 <td colspan=3>
  <span tal:replace="structure context/submit">submit button</span>
  <a tal:condition="context/id" tal:attributes="href context/copy_url"
   i18n:translate="">Make a copy</a>
 </td>
</tr>

</table>
</form>

<!-- Workflow Action Buttons -->
<div tal:condition="context/id" style="margin: 20px 0; padding: 10px; background: #f5f5f5; border: 1px solid #ddd;">
 <strong i18n:translate="">Workflow Actions:</strong>

 <!-- Start Work button: shown when status is "new" -->
 <form tal:condition="python:context.status.id == '1'"
       method="POST" style="display:inline; margin-left: 10px;"
       tal:attributes="action context/designator">
  <input type="hidden" name="status" value="2">
  <input type="hidden" name="@action" value="edit">
  <input type="hidden" name="@template" value="item">
  <input name="@csrf" type="hidden" tal:attributes="value python:utils.anti_csrf_nonce()">
  <input type="submit" value="Start Work" i18n:attributes="value">
 </form>

 <!-- Mark Resolved button: shown when status is "in-progress" -->
 <form tal:condition="python:context.status.id == '2'"
       method="POST" style="display:inline; margin-left: 10px;"
       tal:attributes="action context/designator">
  <input type="hidden" name="status" value="3">
  <input type="hidden" name="@action" value="edit">
  <input type="hidden" name="@template" value="item">
  <input name="@csrf" type="hidden" tal:attributes="value python:utils.anti_csrf_nonce()">
  <input type="submit" value="Mark Resolved" i18n:attributes="value">
 </form>

 <!-- Close Issue button: shown when status is "resolved" -->
 <form tal:condition="python:context.status.id == '3'"
       method="POST" style="display:inline; margin-left: 10px;"
       tal:attributes="action context/designator">
  <input type="hidden" name="status" value="4">
  <input type="hidden" name="@action" value="edit">
  <input type="hidden" name="@template" value="item">
  <input name="@csrf" type="hidden" tal:attributes="value python:utils.anti_csrf_nonce()">
  <input type="submit" value="Close Issue" i18n:attributes="value">
 </form>

 <!-- No workflow actions available -->
 <span tal:condition="python:context.status.id not in ['1', '2', '3']"
       style="margin-left: 10px; font-style: italic;" i18n:translate="">
  No workflow actions available for current status.
 </span>
</div>

<tal:block tal:condition="not:context/id" i18n:translate="">
<table class="form">
<tr>
 <td>Note:&nbsp;</td>
 <th class="required">highlighted</th>
 <td>&nbsp;fields are required.</td>
</tr>
</table>
</tal:block>

<p tal:condition="context/id" i18n:translate="">
 Created on <b tal:content="context/creation" i18n:name="creation" />
 by <b tal:content="context/creator" i18n:name="creator" />,
 last changed <b content="context/activity" i18n:name="activity" />
 by <b tal:content="context/actor" i18n:name="actor" />.
</p>

<table class="files" tal:condition="context/files">
 <tr><th colspan="5" class="header" i18n:translate="">Files</th></tr>
 <tr>
  <th i18n:translate="">File name</th>
  <th i18n:translate="">Uploaded</th>
  <th i18n:translate="">Type</th>
  <th i18n:translate="">Edit</th>
  <th i18n:translate="">Remove</th>
 </tr>
 <tr tal:repeat="file context/files">
  <td>
   <a tal:attributes="href file/download_url"
      tal:content="file/name">dld link</a>
  </td>
  <td>
   <span tal:content="file/creator">creator's name</span>,
   <span tal:content="file/creation">creation date</span>
  </td>
  <td tal:content="file/type" />
  <td><a tal:condition="file/is_edit_ok"
          tal:attributes="href string:file${file/id}">edit</a>
  </td>
  <td>
   <form style="padding:0" method="POST" tal:condition="context/is_edit_ok"
         tal:attributes="action string:issue${context/id}">
    <input type="hidden" name="@remove@files" tal:attributes="value file/id">
    <input name="@csrf" type="hidden"
           tal:attributes="value python:utils.anti_csrf_nonce()">
    <input type="hidden" name="@action" value="edit">
    <input type="submit" value="remove" i18n:attributes="value">
   </form>
  </td>
 </tr>
</table>

<table class="messages" tal:condition="context/messages">
 <tr><th colspan="4" class="header" i18n:translate="">Messages</th></tr>
 <tal:block tal:repeat="msg context/messages/reverse">
  <tr>
   <th><a tal:attributes="href string:msg${msg/id}"
    i18n:translate="">msg<tal:x replace="msg/id" i18n:name="id" /> (view)</a></th>
   <th i18n:translate="">Author: <tal:x replace="msg/author"
       i18n:name="author" /></th>
   <th i18n:translate="">Date: <tal:x replace="msg/date"
       i18n:name="date" /></th>
   <th>
    <form style="padding:0" method="POST" tal:condition="context/is_edit_ok"
          tal:attributes="action string:issue${context/id}">
     <input type="hidden" name="@remove@messages" tal:attributes="value msg/id">
     <input name="@csrf" type="hidden"
            tal:attributes="value python:utils.anti_csrf_nonce()">
     <input type="hidden" name="@action" value="edit">
     <input type="submit" value="remove" i18n:attributes="value">
    </form>
   </th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    <pre tal:content="structure msg/content/hyperlinked">content</pre>
   </td>
  </tr>
 </tal:block>
</table>

<tal:block tal:condition="context/id" tal:replace="structure context/history" />

</div>

</td>

</tal:block>
<!-- SHA: 843196cfd06c6cccc539ce008cf02c14c0832cee -->
